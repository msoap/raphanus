FROM golang:alpine

MOUNT .:/app/src/github.com/msoap/raphanus
WORKDIR /app/src/github.com/msoap/raphanus

ENV GOPATH=/app

RUN apk add --no-cache git && \
    go get ./... && \
    chdir ./server && \
    go build -o raphanus-server

EXPORT /app/src/github.com/msoap/raphanus/server/raphanus-server

# result image with binary only
FROM alpine

RUN mkdir /app
IMPORT raphanus-server /app/raphanus-server
ENTRYPOINT ["/app/raphanus-server"]
CMD ["-address", ":8771"]
EXPOSE 8771

PUSH msoap/raphanus:latest
